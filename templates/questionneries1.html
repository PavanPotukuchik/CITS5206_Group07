<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
    <title>Add Questionneries</title>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="menu-btn">
                <i class="ph-bold ph-caret-left"></i>
            </div>
            <div class="head">
                <div class="user-img">
                    <img src="{{ url_for('static', filename='img/user.jpg') }}" alt="User" />
                </div>
                <div class="user-details">
                    <p class="title">Admin</p>
                    <p class="name">Kartik</p>
                </div>
            </div>
            {% include 'menu.html' %}
        </div>
        <div class="main-content">
            <div class="content-area">
                <div class="card">
                    <h2>Add questions</h2>
                    <div id="basicQuestionsContainer">
                    </div>

                    <div class="question-card">
                        <h3>Or Enter a Custom Question:</h3>                        
                        <form id="questionForm" class="add-form">
                            <div class="form-group">
                                <h3>Enter a question:</h3>
                                <textarea class="input-class" rows = '4' cols="50" id="question" name="question" required> </textarea><br>
                            </div>
                            <div class="form-group">
                                <h4>Select an input type for the question:</h4>
                                <label class="radio-inline">
                                    <input type="radio" name="inputType" value="text" required> Text
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="inputType" value="upload" required> Upload
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="inputType" value="yesNo" required> Yes or No
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="inputType" value="number" required> Number
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="inputType" value="date" required> Date
                                </label><br>
                            </div>
                            <button type="submit" class="add-client-button">Add question</button>
                        </form>
                    </div>
                    <br>
                        <div id="resultList">
                            <ul id="submittedQuestions"></ul> 
                        </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/pocketbase@0.8.0/dist/pocketbase.umd.js"></script>

    <script>

        const pb = new PocketBase('http://127.0.0.1:8090');

        async function loadBasicQuestions() {
            try {
                const basicQuestions = await pb.collection('basicQuestions').getFullList();

                const container = document.getElementById('basicQuestionsContainer');
                basicQuestions.forEach(question => {
                    const div = document.createElement('div');
                    div.classList.add('basic-question-item');
                    div.innerHTML = `
                        <label>
                            <input type="checkbox" class="basic-question" value="${question.id}" data-question="${question.question}" data-type="${question.type}">
                            ${question.question} (Type: ${question.type})
                        </label><br>`;
                    container.appendChild(div);
                });
            } catch (error) {
                console.error('Error fetching basic questions:', error);
            }
        }

        window.onload = loadBasicQuestions;

        const projectId = localStorage.getItem('projectId');
        const clientId = localStorage.getItem('clientId');

        document.getElementById("questionForm").addEventListener("submit", async function(event) {
            event.preventDefault(); 

            const selectedBasicQuestions = [];
            document.querySelectorAll('.basic-question:checked').forEach((checkbox) => {
                selectedBasicQuestions.push({
                    question: checkbox.getAttribute('data-question'),
                    input_type: checkbox.getAttribute('data-type')
                });
            });

            const questionInput = document.getElementById("question").value;
            const selectedInputType = document.querySelector('input[name="inputType"]:checked').value;

            if (questionInput && selectedInputType) { 
                selectedBasicQuestions.push({
                question: questionInput,
                inputType: selectedInputType
                });
            } 

            if (selectedBasicQuestions.length > 0) {
                try {
                    for (const questionData of selectedBasicQuestions) {
                        await pb.collection('questionerries').create({
                            question: questionData.question,
                            inputType: questionData.inputType,
                            project_id: projectId,
                            client_id: clientId
                        });
                    }

                    selectedBasicQuestions.forEach(questionData => {
                        const listItem = document.createElement("li");
                        listItem.innerHTML = `
                            <div class='question-card'>
                                <h3>${questionData.question}</h3>
                                Input Type: ${questionData.inputType}<br>
                            </div><br>`;
                        document.getElementById("submittedQuestions").appendChild(listItem);
                    });

                    document.getElementById("questionForm").reset();

                } catch (error) {
                    console.error('Error adding question:', error);
                }
            } else {
                alert("Please select or enter at least one question.");
            }

        });

    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{{ url_for('static', filename='js/add-client.js') }}"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
